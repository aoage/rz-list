@page "/users"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components
@using RzList.Models
@using RzList.Data
@implements IAsyncDisposable
@inject IDbContextFactory<RzList.Data.RzListDbContext> DbFactory

<PageTitle>Index</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h3" GutterBottom="true">Users</MudText>

    <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Href="users/create"
        Class="mb-4">
        Create New
    </MudButton>

    <MudDataGrid T="User" Items="@context.Users" Filterable="true" SortMode="SortMode.Multiple" Dense="true"
        Hover="true" ReadOnly="true">
        <Columns>
            <PropertyColumn Property="x => x.Username" Title="Username" />
            <PropertyColumn Property="x => x.Email" Title="Email" />
            <PropertyColumn Property="x => x.DateCreated" Title="Date Created" />
            <PropertyColumn Property="x => x.Permissions" Title="Permissions" />

            <TemplateColumn Title="Actions" Sortable="false" Filterable="false">
                <CellTemplate>
                    <MudButtonGroup Variant="Variant.Text" Size="Size.Small">
                        <MudButton StartIcon="@Icons.Material.Filled.Edit" Href="@($"users/edit?id={context.Item.Id}")">
                            Edit
                        </MudButton>
                        <MudButton StartIcon="@Icons.Material.Filled.Info"
                            Href="@($"users/details?id={context.Item.Id}")">
                            Details
                        </MudButton>
                        <MudButton StartIcon="@Icons.Material.Filled.Delete" Color="Color.Error"
                            Href="@($"users/delete?id={context.Item.Id}")">
                            Delete
                        </MudButton>
                    </MudButtonGroup>
                </CellTemplate>
            </TemplateColumn>
        </Columns>
    </MudDataGrid>
</MudContainer>

@code {
    private RzListDbContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
